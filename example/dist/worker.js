(function(){"use strict";var S=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},s=(i,e,t)=>(S(i,e,"read from private field"),t?t.call(i):e.get(i)),r=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},p=(i,e,t,n)=>(S(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),o=(i,e,t)=>(S(i,e,"access private method"),t),f,d,b,l,c,u,g,w,v,m,y,k,T,I,O,W,U;class q{constructor(){r(this,m),r(this,k),r(this,I),r(this,W),r(this,f,crypto.randomUUID()),r(this,d,void 0),r(this,b,null),r(this,l,[]),r(this,c,new Map),r(this,u,new Map),r(this,g,void 0),r(this,w,{timeout:1e4}),r(this,v,e=>{const{id:t,type:n}=e.data;if(!t||!n)return;const a=s(this,c).get(t);if(a)a.timer&&clearTimeout(a.timer),s(this,c).delete(t),n==="error"?a.reject(e.data):a.resolve(e.data);else{const h=s(this,u).get(t);h&&h(e.data)}})}setOptions(e){p(this,w,{...s(this,w),...e})}async postRequest(e="",t){const n=crypto.randomUUID(),a="request",h=s(this,f);return o(this,W,U).call(this,{id:n,senderId:h,type:a,name:e,body:t}),o(this,I,O).call(this,n,e)}subscribe(e,...t){let n,a;t[0]instanceof Function?n=t[0]:t[1]instanceof Function&&(a=t[0],n=t[1]);const h=crypto.randomUUID(),M="subscription",P=s(this,f);return s(this,u).set(h,n),o(this,W,U).call(this,{id:h,senderId:P,type:M,name:e+":subscribe",body:a||void 0}),()=>{s(this,u).delete(h),setTimeout(()=>{o(this,m,y).call(this,{id:h,senderId:P,type:M,name:e+":unsubscribe",body:a||void 0})},0)}}connect(e,t){return t||(t=e),t instanceof MessagePort?t.onmessage=s(this,v):t.addEventListener("message",s(this,v)),p(this,g,t),p(this,d,e),new Promise(n=>setTimeout(n,0))}disconnect(){var e;o(this,m,y).call(this,{id:s(this,f),type:"request",name:"disconnect"}),s(this,u).clear(),s(this,c).clear(),(e=s(this,g))==null||e.removeEventListener("message",s(this,v)),p(this,d,void 0)}}f=new WeakMap,d=new WeakMap,b=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,g=new WeakMap,w=new WeakMap,v=new WeakMap,m=new WeakSet,y=function(i){var e;const t=s(this,d)===self.parent||s(this,d)===self.opener?"*":void 0;(e=s(this,d))==null||e.postMessage(i,t)},k=new WeakSet,T=function(i){return JSON.parse(JSON.stringify(i))},I=new WeakSet,O=function(i,e,t=1e4){return t=s(this,w).timeout||t,t?new Promise((n,a)=>{const h=setTimeout(()=>{const M=s(this,c).get(i);s(this,c).delete(i),a(new Error("timeout on "+M.name))},t);s(this,c).set(i,{name:e,timer:h,resolve:n,reject:a})}):new Promise((n,a)=>{s(this,c).set(i,{name:e,resolve:n,reject:a})})},W=new WeakSet,U=function(i){if(s(this,l).push(i),clearTimeout(s(this,b)),s(this,l).length>=10){o(this,m,y).call(this,{batch:o(this,k,T).call(this,s(this,l))}),s(this,l).length=0;return}p(this,b,setTimeout(()=>{try{o(this,m,y).call(this,{batch:o(this,k,T).call(this,s(this,l))})}catch{}s(this,l).length=0},1))};const E=(()=>new q)();E.connect(self),E.postRequest("echo","hello from web worker!").then(i=>{console.log("response from receiver",JSON.stringify(i,null,2))})})();
